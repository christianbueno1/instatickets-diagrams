@startuml
' Título
title Diagrama de Clases - Sistema InstaTickets

' Configuración para layout vertical
!define DIRECTION top to bottom direction
skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam linetype ortho

' Capa Superior - Usuarios y Seguridad
package "Usuarios y Permisos" {
    class Usuario {
        +id: UUID
        +nombre: String
        +email: String
    }

    class Rol {
        +id: UUID
        +nombre: String
    }

    class Permiso {
        +id: UUID
        +accion: String
    }
}

' Capa de Clientes y Eventos
package "Eventos y Clientes" {
    class Cliente {
        +id: UUID
        +nombre: String
        +ruc: String
    }

    class Evento {
        +id: UUID
        +nombre: String
        +fecha: DateTime
    }

    class Sede {
        +id: UUID
        +nombre: String
        +direccion: String
    }
}

' Capa Central - Core del Sistema
package "Escenarios y Mapas" {
    class Mapa {
        +id: UUID
        +nombre: String
        +estado: EstadoMapa
        +configuracion: ConfiguracionMapa
    }

    class Localidad {
        +id: UUID
        +nombre: String
        +color: String
        +capacidad: int
    }

    class Asiento {
        +id: UUID
        +fila: String
        +numero: String
        +estado: String
    }

    class PuntoDeInteres {
        +id: UUID
        +tipo: String
        +descripcion: String
    }

    class GrupoAsientos {
        +id: UUID
        +nombre: String
    }

    class Snippet {
        +id: UUID
        +codigoHTML: String
        +token: TokenAcceso
    }
}

' Capa de Configuración
package "Configuración y Visual" {
    class ConfiguracionLocalidad {
        +alineacion: String
        +colorBorde: String
    }

    class ConfiguracionMapa {
        +modoOscuro: Boolean
        +tipoNumeracion: String
    }

    class EditorVisual {
        +id: UUID
        +activo: Boolean
    }
}

' Capa de Seguridad y Auditoría
package "Seguridad y Auditoría" {
    class HistorialCambios {
        +id: UUID
        +usuarioId: UUID
        +cambio: String
        +fecha: DateTime
    }

    class VersionMapa {
        +id: UUID
        +fecha: DateTime
        +autor: String
    }

    class TokenAcceso {
        +token: String
        +expira: DateTime
    }
}

' Capa de Validaciones
package "Validaciones y Estados" {
    class ReglaAforo {
        +id: UUID
        +capacidadMaxima: int
    }

    class RestriccionEdicion {
        +zona: String
        +motivo: String
    }

    class EstadoMapa {
        +estado: String
    }
}

' Capa de Estadísticas
package "Estadísticas" {
    class EstadisticaMapa {
        +visitas: int
        +interacciones: int
    }
}

' Definir layout vertical para mejor organización
Usuario ||--down--|| Rol : tiene
Rol ||--down--o{ Permiso : otorga

Cliente ||--down--o{ Evento : organiza
Evento ||--right--|| Sede : se_realiza_en

' Relaciones principales del core del sistema
Mapa ||--down--o{ Localidad : contiene
Localidad ||--down--o{ Asiento : contiene
Mapa ||--down--o{ PuntoDeInteres : incluye
Mapa ||--down--o{ GrupoAsientos : agrupa
GrupoAsientos ||--down--o{ Asiento : incluye

' Conexión entre eventos y mapas
Evento ||--down--|| Mapa : utiliza

' Relaciones de configuración
Mapa ||--down--|| ConfiguracionMapa : configurado_por
Localidad ||--down--|| ConfiguracionLocalidad : configurado_por

' Relaciones de seguridad y auditoría
Mapa ||--down--o{ Snippet : embebe
Mapa ||--down--o{ VersionMapa : versiona
Mapa ||--down--o{ HistorialCambios : registra
Snippet ||--right--|| TokenAcceso : protegido_por

' Relaciones de validación y control
Mapa ||--down--o{ ReglaAforo : tiene
Mapa ||--down--o{ RestriccionEdicion : tiene

' Relaciones de editor visual
EditorVisual ||--down--|| Mapa : edita
EditorVisual ||--down--|| Localidad : modifica

' Relaciones de estadísticas
Mapa ||--down--o{ EstadisticaMapa : genera

@enduml
